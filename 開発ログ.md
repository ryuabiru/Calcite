# プロジェクト「Calcite」開発ログ (2025/08/21更新)

## 1. このプロジェクトで実装したいこと

-   **直感的な操作性**: `Mito`や`GraphPad Prism`のように、プログラミング知識がなくてもGUI操作だけでデータハンドリング、統計解析、グラフ作成が完結するアプリケーションを目指す。
-   **統合環境**: データのインポート、表計算、統計解析、グラフ描画、結果のエクスポートといった一連のワークフローを、シームレスに一つのウィンドウで提供する。
-   **論文品質のグラフ**: ユーザーがタイトル、ラベル、色、エラーバーなどを自由に編集でき、学術論文やプレゼンテーションにそのまま利用できる高品質なグラフを作成できる機能。

---

## 2. これまでに実装してきたこと

-   **基本UI/UXの改善**
    -   **レイアウト変更**: プロパティパネルを画面下部に配置し、データテーブルとグラフの表示領域を拡大。**メインウィンドウを上下分割する`QSplitter`を導入し、起動時のプロパティパネルの高さを最適化**しました。
    -   **タブUIの導入**: プロパティパネルを「データ」「フォーマット」「テキスト」「軸」のタブに分割し、設定項目を整理してアクセス性を向上。
    -   **高DPI対応**: アプリケーション全体で高解像度ディスプレイをサポートし、グラフやフォントが鮮明に表示されるように改善。

-   **データハンドリング機能**
    -   **CSVファイルのインポート**: メニューバーからCSVを読み込み、`Pandas`データフレームとして内部で保持。
    -   **クリップボードからのペースト**: Excelなどからコピーしたタブ区切りデータをアプリケーションに直接貼り付ける機能を追加 (`Edit` > `Paste`)。
    -   **テーブル表示とインタラクティブ編集**:
        -   `QTableView`を用いたスプレッドシート形式での表示、セルやカラムヘッダーの直接編集機能。
        -   右クリックメニューからの行・列の追加、削除機能。
    -   **データ変換**:
        -   **ワイドからロングへ**: `pandas.melt`を基盤としたGUIツールで、データをTidy Data形式に再構成する機能。
        -   **数式による列作成**: `pandas.eval`を基盤とし、「`'ColumnA' * 100`」のような数式で新しい列を動的に作成する機能。

-   **グラフ描画・編集機能 (v2, v4)**
    -   **描画エンジン**: プロパティパネルからY軸(値), X軸(グループ), サブグループを指定するTidy Dataベースの柔軟な方式。
    -   **グラフタイプ**: ツールバーから**散布図**と**棒グラフ**（エラーバー、個別データ点の重ね描き対応）を動的に切り替え。
    -   **プロパティパネルによる詳細な編集**:
        -   **テキスト**: グラフのタイトル、X/Y軸ラベル、目盛りの**フォントサイズ**を個別に設定可能に。
        -   **軸**: X/Y軸の**表示範囲 (Min/Max)** の手動設定、および**対数スケール (Log Scale)** への切り替え機能を追加。グリッド線の表示/非表示も可能に。
        -   **フォーマット**: マーカーの種類や色、枠線の色・太さなどを設定可能に。**散布図マーカーと棒グラフの枠線の色・太さ、エラーバーのキャップサイズ、フィットラインのスタイル・太さを個別にGUIから調整**できるようになりました。
        -   **Prism風スタイル**: グラフの**上と右の枠線（Spine）を非表示にするオプション**を追加し、学術論文で好まれる洗練された見た目を実現できます。
    -   **描画の維持**: グラフのプロパティ更新時に、描画した回帰直線やフィッティング曲線が消えないようにロジックを改善。

-   **統計解析とアノテーション機能 (v3, v4)**
    -   **t検定のTidy Dataへの完全対応**: ワイド形式を前提としていたt検定の仕様を刷新。ANOVAと同様に**「値の列」と「グループ分けの列」を指定するTidy Data形式に完全対応**し、アプリケーションの思想を統一しました。
    -   **高度なアノテーション機能**:
        -   t検定の結果（p値）を、グラフ上に**有意差を示すアスタリスク(\*)とブラケット**として描画する機能を実装しました。
        -   **複数アノテーションの自動整列**: 複数の検定結果を追加する際、ブラケットが重ならないよう、**「レベル」概念を用いたアルゴリズム**によってY軸方向へ自動的に積み重なって描画されます。幅が狭い比較から順に描画することで、視覚的にも美しいレイアウトを実現します。
        -   **Y軸の自動拡大**: アノテーションがグラフの表示領域を超える場合、**Y軸の上限が自動的に拡大**され、すべてのアノテーションが描画領域内に収まるよう調整されます。
        -   `Edit > Clear Annotations`メニューから、描画したアノテーションを一括消去できます。
    -   **一元配置分散分析 (ANOVA)**: 3群以上の比較に対応。
    -   **カイ二乗検定**: `pd.crosstab`を利用し、2つのカテゴリカル変数間の関連を検定する機能を追加。
    -   **線形・非線形回帰分析**: 散布図にフィットラインを描画し、凡例に**R²値**を表示。シグモイド曲線（4パラメータロジスティックモデル）のフィッティングにも対応します。
-   **エクスポート機能**
    -   作成したグラフを**PNG, JPEG, SVG, PDF**形式で、300 DPIの高解像度で保存する機能を追加 (`File` > `Save Graph As...`)。
-   **ANOVAの多重比較アノテーション**: ANOVAで有意差があった場合に、どの群間に差があるかを示す文字（a, b, cなど）をグラフ上に自動で追加する機能。

---

## 3. これからの実装予定

-   **グラフ編集機能のさらなる強化**
    -   **テキスト・図形追加**: グラフ上の任意の位置にテキストボックスや矢印、図形などを追加・編集する機能。

-   **データハンドリング機能の強化**
    -   **フィルタリング**: 特定の条件（例: `Value > 10`）で表示するデータを絞り込むUI機能。
    -   **ソート**: 列ヘッダーのクリックでデータを並び替える機能。

-   **統計解析機能の追加**
    -   **対応のあるt検定**や**二元配置分散分析**など、より高度な統計手法の実装。

-   **エクスポート機能の強化**
    -   表示されているテーブルデータをCSV形式で保存する機能。